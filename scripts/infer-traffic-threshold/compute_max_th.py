import pandas as pd
import numpy as np
from datetime import datetime
import sys

df = pd.read_csv(sys.argv[1], error_bad_lines=False, sep=";")

#th=float (sys.argv[2])

mac_dev = sys.argv[2]

bob_ips = ["52.94.233.109","52.94.233.109","54.239.21.157","54.239.21.157","52.94.229.122","52.94.229.122","52.119.197.96","52.119.197.96","54.239.23.243","54.239.23.243","52.94.227.146","52.94.227.146","52.94.242.249","52.94.242.249","52.94.233.109","52.94.233.109","54.239.26.171","54.239.26.171","52.46.158.181","52.46.158.181","52.119.197.96","52.119.197.96","54.239.18.66","54.239.18.66","52.94.227.146","52.94.227.146","52.94.242.249","52.94.242.249","52.46.158.181","52.46.158.181","52.94.243.11","52.94.243.11","52.94.229.122","52.94.229.122","52.119.197.116","52.119.197.116","54.239.18.66","54.239.18.66","52.94.235.50","52.94.235.50","52.94.243.11","52.94.243.11","52.94.235.50","52.94.235.50","52.119.197.116","52.119.197.116","52.94.233.109","52.94.233.109","52.119.197.96","52.119.197.96","52.94.227.146","52.94.227.146","52.94.242.249","52.94.242.249","52.46.158.181","52.46.158.181","52.94.243.11","52.94.243.11","52.94.229.122","52.94.229.122","52.119.197.116","52.119.197.116","54.239.25.188","54.239.25.188","52.94.235.50","52.94.235.50","54.239.18.66","54.239.18.66","52.95.113.144","52.95.117.89","52.95.115.208","52.95.119.186","52.95.122.231","52.95.119.186","52.95.113.144","54.239.38.218","52.95.121.5","52.95.122.231","52.95.119.186","54.239.39.74","52.95.115.208","52.94.216.73","52.95.121.5","52.95.117.89","54.239.38.218","52.95.121.5","52.95.122.231","52.95.113.144","54.239.39.74","52.95.115.208","52.94.216.73","52.95.117.89","52.95.113.144","52.95.117.89","52.94.216.73","54.239.38.218","52.95.121.5","52.95.122.231","54.239.39.74","52.95.119.186","52.95.115.208"]

time_pcap=df['frame_time_epoch'].iloc[0]

df['frame_time_epoch'] = pd.to_datetime(df['frame_time_epoch'],unit='s')

data=df[(df['eth_src'] == mac_dev) & (df['tcp_dstport'] == 443) & (df['ip_dst'].isin(bob_ips))]

df2=data.groupby(pd.TimeGrouper(key='frame_time_epoch', freq='1s')).sum()

th=df2['frame_len']

th_max=th.max()

print (th_max)
